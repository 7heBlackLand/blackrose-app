name: Secure Commit and Push with PAT

on:
  push:
    branches:
      - main
  workflow_dispatch:  # ম্যানুয়ালি trigger করার জন্য

permissions:
  contents: write  # GITHUB_TOKEN use করলে write permission

jobs:
  commit-and-push:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false  # Explicit token ব্যবহার করব

      # Step 2: Create a sample file
      - name: Create hello.txt
        run: |
          mkdir -p output
          echo "Hello World from PAT workflow" > output/hello.txt

      # Step 3: Commit and push using PAT
      - name: Commit and push file
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}  # GitHub secret থেকে token
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add output/hello.txt

          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Add hello.txt from workflow at $(date +'%Y-%m-%d %H:%M:%S')"
            git push https://x-access-token:${PAT_TOKEN}@github.com/${{ github.repository }}.git main
          fi
